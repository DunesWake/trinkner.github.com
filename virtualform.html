<html class="no-js" lang="en">
    <head>
        <title>virtual form</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0">
        <meta name="description" content="proof of concept test site"/>
        <link rel="shortcut icon" href="#">
        <style>	
            body {
                position:fixed;
                margin:0;
                padding:0;
                max-width: 100%;
                height: auto;
            }
            #rightMenu{
                position: fixed; 
                top:49vh;
                right:2.5vw;
            }
            #leftMenu{
                position: fixed; 
                top:49vh;
                left:2.5vw;
            }
            #screenClick > button{
                color: transparent; 
                background-color: transparent; 
                border-color: transparent; 
                cursor: default;
                outline: 0;
                width: 100vw;
                height: 100vh;
            }
            
            #screenClick{
                position: fixed; 
                top:0vh;
                left:0vw;
                width:100%;
                height:100%;
            }
            a {
                font-size: 17px;
                text-decoration: none;
                color: #999;
            }
            canvas {
                position: fixed;
                top: 0;
                left: 0;
                z-index: -9999;
                margin:0;
                padding:0;		
            }    
            
            #loading-screen {
                position: fixed;
                z-index: -9999;
                top: 49%;
                opacity:0;
                text-align: center;
                width:100vw;
            }
            #loading-screen.fade-in  {opacity: 1;}
        </style>
    </head>
    <body>
        <div id="leftMenu">  </div>
        <div id="rightMenu"> </div>
        <div id="screenClick"> </div>
    </body>
</html>
        
<section id="loading-screen"></section>

<script src=".//js/threex.windowresize.js"></script>
<script type="module">
    const loadingScreen = document.getElementById( 'loading-screen' );
    loadingScreen.classList.add( 'fade-in' ); 

	import * as THREE from './/js/three.module.js';
	import {GLTFLoader} from './/js/GLTFLoader.js';
    var renderer;
	var scene;
	var manager = new THREE.LoadingManager();
	var loader = new GLTFLoader(manager);
    var files = [".//forms/2.glb", ".//forms/3.glb", ".//forms/anime.glb", ".//forms/small.glb"];
    var cur = 0;
    
    var cam0;
    var light0;
    var forms = []
	init();
	load();
	// animate calls onLoad.
	
	function init() {
		renderer = new THREE.WebGLRenderer({alpha: true, antialias:false});
		renderer.setSize(window.innerWidth, window.innerHeight);
		document.body.appendChild(renderer.domElement);
		scene = new THREE.Scene();

        light0 = new THREE.PointLight(0xFFFFFF);
        light0.position.set(-100, -200, 100);
        scene.add(light0);
		
		cam0 = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
		cam0.position.z = 5.25;
        
        THREEx.WindowResize(renderer, cam0)
	}
    	
	function load() {
        for (let i = 0; i < files.length; i++) {
            loader.load( files[i], function (entity) {
                let form = entity.scene;
                form.name = files[i];
                form.updateMatrixWorld();
                forms[i] = form;
            })
        }
        
        manager.onProgress = function ( item, loaded, total ) {
            loadingScreen.innerHTML = (loaded - 1) + " / " + (total - 1);
            console.log((loaded - 1) + " " + (total - 1) + " " + item);
        };
            
        manager.onLoad = function() {
            loadingScreen.classList.remove( 'fade-in' );
            buttonCreate();
            KeyControls();
            rotateInit();
            scene.add(forms[cur]);
            anim(); 
		};
	}
        
	function anim() {
		let animate = function() {
			requestAnimationFrame(animate);
			forms[cur].rotation.x += 0.002;
			forms[cur].rotation.y += 0.002;
			renderer.render(scene, cam0);
		};
        animate();
	}
    
    function rotateInit() {
        forms[cur].rotation.set(0,0,0);
        forms[cur].rotateX(6);
        forms[cur].rotateY(2);
        if (forms[cur].name == ".//forms/anime.glb" || forms[cur].name == ".//forms/small.glb") {
            forms[cur].rotation.x +=3.03;
            forms[cur].rotation.y +=3.03;
        } else {
            forms[cur].rotation.x += 2;
        }
    }
       
    var incr;
    var dir = true;
    function walk(event) {
        removeForm(forms[cur]);

        if(cur == files.length - 1){
            dir = false;
            incr = -1;
        } else if (cur == 0) {
            dir = true;
            incr = 1;
        }
        
        cur += incr;
        rotateInit();
        scene.add(forms[cur])
    }
    
    function next(event) {
        if(cur < files.length - 1){
            removeForm(forms[cur]);
            cur++; 
            rotateInit();
            scene.add(forms[cur])
        }
    }
    
    function back(event) {
        if(cur > 0){
            removeForm(forms[cur]);
            cur--; 
            rotateInit();
            scene.add(forms[cur])        }
    }
    
    function KeyControls() {
        document.onkeydown = function(e) {
            switch (e.keyCode) {
                case 37:
                    back();
                    break;
                case 39:
                    next();
                    break;
            }
        };
    }
    
    function buttonCreate(){
        // BACK AND NEXT BUTTONS
//        var mnuItem1 = document.createElement("a");
//        mnuItem1.name = "next";
//        mnuItem1.href = "#";
//        mnuItem1.innerHTML = "next";
//        mnuItem1.addEventListener("click", next);
//        rightMenu.appendChild(mnuItem1);
//        
//        var mnuItem = document.createElement("a");
//        mnuItem.name = "back";
//        mnuItem.href = "#";
//        mnuItem.innerHTML = "back";
//        mnuItem.addEventListener("click", back);
//        leftMenu.appendChild(mnuItem);
        
        var screenC = document.createElement("button");
        screenC.name = "walk";
        screenC.href = "#";
        screenC.innerHTML = "walk";
        screenC.addEventListener("click", walk);
        screenClick.appendChild(screenC);
    }
    
    function removeForm(object) {
        var selectedObject = scene.getObjectByName(object.name);
        scene.remove( selectedObject );
    }
</script>
  
